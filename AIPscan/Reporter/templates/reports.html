{% extends "base.html" %}

{% block content %}

<!--TODO container-fluid is also present on base.html should this be a
    different class?
-->
<div class="container-fluid">

    <!-- TODO: Same question as container-fluid for consistency across the
         application.
    -->
    <div class="container-alert"></div>

    <div class="alert alert-header"><strong>Reports</strong></div>

    <div style="padding-left: 1.25rem;">
        <strong>Storage service:</strong>
        <select id="ss" method="GET" action="/" class="form-control" style="width:auto;">
            {% for ss in storage_services %}
            {% if ss.default == 1 %}
            <option value="{{ ss.id }}" SELECTED>{{ ss.name }}</option>
            {% else %}
            <option value="{{ ss.id }}">{{ ss.name }}</option>
            {% endif %}
            {% endfor %}
        </select>
    </div>

    <table class="table table-striped table-bordered" style="margin: 1.25rem;">

        <tr>
            <th>Report</th>
            <th><img src="{{ url_for('static', filename='assets/calendar-icon.png') }}" style="height: 1.5em; margin-right: 5px;" />Start date</th>
            <th><img src="{{ url_for('static', filename='assets/calendar-icon.png') }}" style="height: 1.5em; margin-right: 5px;" />End date</th>
            <th>Format</th>
        </tr>

        <tr>
            <td>File format count</td>
            <td><input id="startdate1" type="text" value="{{ start_date }}">
            </td>
            <td><input type="text" id="enddate1" value="{{ end_date }}"></td>
            <td><a href=""><button type="button" id="report1a" class="btn btn-info" style="margin-left:5px; margin-bottom:5px;">Tabular</button></a><a href=""><button type="button" id="report1b" class="btn btn-info" style="margin-left:5px; margin-bottom:5px;">Pie Chart</button></a><a href=""><button type="button" id="report1c" class="btn btn-info" style="margin-left:5px; margin-bottom:5px;">Scatter Plot</button></a></td>
        </tr>

        <tr>
            <td>AIP contents</td>
            <td></td>
            <td></td>
            <td><a href="#"><button type="button" id="report2a" class="btn btn-info" style="margin-left:5px; margin-bottom:5px;">Tabular</button></a></td>
        </tr>

        <tr>
            <td>Format version count</td>
            <td></td>
            <td></td>
            <td><a href="#"><button type="button" id="report3a" class="btn btn-info" style="margin-left:5px; margin-bottom:5px;">Tabular</button></a></td>
        </tr>

        <tr>
            <td>Preservation copy count</td>
            <td></td>
            <td></td>
            <td><a href="#"><button type="button" id="report4a" class="btn btn-info" style="margin-left:5px; margin-bottom:5px;">Tabular</button></a></td>
        </tr>

    </table>

</div>

<!-- TODO: Let's get this into a separate JS and import it... -->
<script>

    const WARNINGS = {
      ALERT_SECONDARY: "secondary",
      ALERT_INFO: "info",
    };

    // TODO: This should be a generic function across the app, so let's get
    // this into it's own import too.
    //
    // TODO: Are there more idiomatic approaches? ðŸ¤·
    bootstrap_alert = function(message, alertType) {
      $("body > div.container-fluid > div > div.container-alert").html(
        '<div class="alert alert-' +
        alertType +
        '"><a class="close" data-dismiss="alert">Ã—</a><span>' +
        message +
        "</span></div>"
      )
    }

    $(document).ready(function() {
        $("#startdate1").datepicker({
            dateFormat: 'yy-mm-dd',
            onSelect: function(date) {
                var enddate = $('#enddate1').val();
                if (enddate != "") {
                    if (enddate < date) {
                        alert("The start date must be before the end date");
                    }
                }
            }
        });
        $("#enddate1").datepicker({
            dateFormat: 'yy-mm-dd',
            onSelect: function(date) {
                var startdate = $('#startdate1').val();
                if (startdate != "") {
                    if (startdate > date) {
                        alert("The start date must be before the end date");
                    }
                }
            }
        });
        $("#report1a").on("click", function() {
            var startdate = $('#startdate1').val();
            var enddate = $('#enddate1').val();
            if (enddate < startdate) {
                alert("The start date must be before the end date");
            } else {
                var storageServiceId = $('#ss').val();
                var url = window.location.origin +
                    '/reporter/report_formats_count?startdate=' +
                    startdate +
                    '&enddate=' +
                    enddate +
                    '&ssId=' +
                    storageServiceId
                window.open(url);
            }
        });
        $("#report1b").on("click", function() {
            var startdate = $('#startdate1').val();
            var enddate = $('#enddate1').val();
            if (enddate < startdate) {
                alert("The start date must be before the end date");
            } else {
                var storageServiceId = $('#ss').val();
                var url = window.location.origin +
                    '/reporter/chart_formats_count?startdate=' +
                    startdate +
                    '&enddate=' +
                    enddate +
                    '&ssId=' +
                    storageServiceId
                window.open(url);
            }
        });
        $("#report1c").on("click", function() {
            var startdate = $('#startdate1').val();
            var enddate = $('#enddate1').val();
            if (enddate < startdate) {
                alert("The start date must be before the end date");
            } else {
                var storageServiceId = $('#ss').val();
                var url = window.location.origin +
                    '/reporter/plot_formats_count?startdate=' +
                    startdate +
                    '&enddate=' +
                    enddate +
                    '&ssId=' +
                    storageServiceId
                window.open(url);
            }
        });
        $("#report2a").on("click", function() {
            bootstrap_alert('This is a demo of report two!', WARNINGS.ALERT_SECONDARY);
            const URL_AIP_CONTENTS = "/reporter/aip_contents/"
            var storageServiceID = $('#ss').val();
            var url = (
              window.location.origin +
              URL_AIP_CONTENTS +
              '?amss_id=' +
              storageServiceID
            );
            window.open(url);
        });
        $("#report3a").on("click", function() {
            bootstrap_alert('Coming soon...', WARNINGS.ALERT_INFO);
        });
        $("#report4a").on("click", function() {
            bootstrap_alert('This is a demo of report three!', WARNINGS.ALERT_SECONDARY);
            const URL_AIP_CONTENTS = "/reporter/original_derivatives/";
            var storageServiceID = $('#ss').val();
            var url = (
              window.location.origin +
              URL_AIP_CONTENTS +
              '?amss_id=' +
              storageServiceID
            );
            window.open(url);
        });
    });
</script>

{% endblock %}
