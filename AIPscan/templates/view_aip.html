{% extends "base.html" %}

{% block content %}

<div class="alert alert-info"><h2 class="h2">AIP: {{ aip.transfer_name }}</h2></div>

<div class="container-fluid">
  <div class="row">
    <div class="col">
      <table class="table table-bordered table-condensed">
        <tr><td width=20%><strong>AIP UUID</strong></td><td>{{ aip.uuid }}</td></tr>
        <tr><td width=20%><strong>Creation date</strong></td><td>{{ aip.create_date }}</td></tr>
        <tr><td width=20%><strong>Originals</strong></td><td>{{ aip.originals }}</td></tr>
        <tr><td width=20%><strong>Preservation copies</strong></td><td>{{ aip.preservation_copies }}</td></tr>
        <tr><td width=20%><strong>Storage service</strong></td><td><a href="/storage_service/{{ storageService.id }}">{{ storageService.name }}</a></td></tr>
        <tr><td width=20%><strong>Fetch job</strong></td><td><a href="/view_aips/{{ fetchJob.id }}">{{ fetchJob.download_start }}</a></td></tr>
      </table>
    </div>
    <div class="col">
      <div class="col-lg" id="formatChart" style="display: block; margin-bottom: 10px;">
        <canvas id="chart" width="400" height="400" aria-label="Format pie chart" role="img">
          <!-- Fallback text -->
          <p>Canvas element not supported.</p>
        </canvas>
      </div>
    </div>
  </div>
</div>

<div class="alert alert-info"><h4>Originals ({{ aip.originals }})</h4></div>

<table id="aiptable" class="table table-striped table-bordered">
  <thead>
  <tr>
  <th><strong>Name</strong></th>
  <th><strong>UUID</strong></th>
  <th><strong>Size</strong></th>
  <th><strong>PUID</strong></th>
  <th><strong>Format</strong></th>
  <th><strong>Last modified</strong></th>
  <th><strong>Ingestion date</strong></th>
  <th><strong>Preservation copy</strong></th>
  </tr>
  </thead>
  {% if originals %}
    {% for original in originals %}
      <tr>
        <td>{{ original.name }}</td>
        <td>{{ original.uuid }}</td>
        <td>{{ original.size }} bytes</td>
        <td>{{ original.puid }}</td>
        <td>{{ original.format }} {% if original.format_version != None %} {{original.format_version}}{% endif %}</td>
        <td>{{ original.creation_date }}</td>
        <td>{{ original.ingestion_date }}</td>
        <td>{{ original.related_uuid }}</td>
      </tr>
    {% endfor %}
  {% endif %}
</table>

{% if preservationCopies %}
<div class="alert alert-info" style="margin-top: 40px;"><h4>Preservation copies ({{ aip.preservation_copies }})</h4></div>

<table id="aiptable2" class="table table-striped table-bordered">
  <thead>
  <tr>
  <th><strong>Name</strong></th>
  <th><strong>UUID</strong></th>
  <th><strong>Size</strong></th>
  <th><strong>Format</strong></th>
  <th><strong>Normalization date</strong></th>
  <th><strong>Original</strong></th>
  </tr>
  </thead>

    {% for preservationCopy in preservationCopies %}
      <tr>
        <td>{{ preservationCopy.name }}</td>
        <td>{{ preservationCopy.uuid }}</td>
        <td>{{ preservationCopy.size }} bytes</td>
        <td>{{ preservationCopy.format }}</td>
        <td>{{ preservationCopy.normalization_date }}</td>
        <td>{{ preservationCopy.related_uuid }}</td>
      </tr>
    {% endfor %}
</table>
{% endif %}


<script>
// draw format chart

let randCols = []
let jsonLabels = {{ labels|tojson }}
let jsonValues = {{ values|tojson }}

let makeColor = function() {
  var r = Math.floor(Math.random() * 255)
  var g = Math.floor(Math.random() * 255)
  var b = Math.floor(Math.random() * 255)
  return "rgb(" + r + "," + g + "," + b + ")"
}
for (let x=0;x<jsonValues.length;x++){randCols.push(makeColor())}

let canvas = document.getElementById("chart")
let ctx = canvas.getContext("2d")

let config = {
    type: 'pie',
    data: {
      labels: jsonLabels,
      datasets: [{
        data: jsonValues,
        label: "Formats chart",
        backgroundColor: randCols,
      }],
    },
    options: {responsive: false},
  }
 let myPie = new Chart(ctx, config)
</script>


{% endblock %}
