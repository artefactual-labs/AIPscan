{% extends "base.html" %}

{% block content %}

<div class="alert alert-info"><h3 class="h3"><a href="/storage_service/{{ storageService.id }}">{{ storageService.name }}</a></h3></div>


<table class="table table-bordered table-condensed">
<tr><td width=20%><strong>Total AIPs</strong></td><td>{{ metsFetchJob.total_aips }}</td></tr>
<tr><td width=20%><strong>Total original files</strong></td><td>{{ originalsCount }}</td></tr>
<tr><td width=20%><strong>Scan date</strong></td><td><a href="/view_aips/{{ metsFetchJob.id }}">{{ metsFetchJob.download_start }}</a></td></tr>
<tr><td width="20%"><strong>Ingest start date</strong></td><td><input type="text" id="startdate" value="{{ startdate }}"></td></tr>
<tr><td width="20%"><strong>Ingest end date</strong></td><td><input type="text" id="enddate" value="{{ enddate }}"></td></tr>
</table>

<div class="alert alert-info"><h4 class="h3">File formats count {% if startdate %}(ingested between {{startdate}} and {{enddate}}){% endif %}</h4></div>
<table id="aiptable" class="table table-striped table-bordered">
  <thead>
  <tr>
  <th width="30%"><strong>Format</strong></th>
  <th><strong>Count</strong></th>
  </tr>
  </thead>
  {% if formatCounts %}
    {% for key,value in formatCounts.items() %}
      <tr>
        <td>{{ key }}</td>
        <td>{{ value }}</td>
      </tr>
    {% endfor %}
  {% endif %}
</table>
</div>

<script>
$(document).ready(function(){
  $("#startdate").datepicker({
    dateFormat: 'yy-mm-dd',
    onSelect: function (date) {
      var enddate = $('#enddate').val();
      if (enddate != "") {
        if (enddate < date) {
          alert("The start date must be before the end date");
        }
        else {
          $.ajax({
                  url: "/report_file_formats_range",
                  type: "GET",
                  data: {"startdate" : date, "enddate": enddate},
          })
          .done(function( json ) {
            location.reload(true);
          })
          .fail(function() {
          })
        }
      }
    }
    });
  $("#enddate").datepicker({
    dateFormat: 'yy-mm-dd',
    onSelect: function (date) {
      var startdate = $('#startdate').val();
      if (startdate != ""){
        if (startdate > date) {
          alert("The start date must be before the end date");
        }
        else {
          $.ajax({
                  url: "/report_file_formats_range",
                  type: "GET",
                  data: {"startdate" : startdate, "enddate": date},
          })
          .done(function( json ) {
            location.reload(true);
          })
          .fail(function() {
          })
        }
      }
    }
    });
});
</script>

{% endblock %}
