{% extends "base.html" %}

{% block content %}

<div class="alert alert-info"><strong>Storage Service</strong></div>

<table class="table table-bordered table-condensed">
  <tr><td width=20%><strong>Name</strong></td><td>{{ storageService.name }}</td></tr>
  <tr><td width=20%><strong>URL</strong></td><td>{{ storageService.url}}</td></tr>
  <tr><td width=20%><strong>User name</strong></td><td>{{ storageService.user_name}}</td></tr>
  <tr><td width=20%><strong>API key</strong></td><td>{{ storageService.api_key}}</td></tr>
  <tr><td width=20%><strong>Default service</strong></td><td>{{ storageService.default}}</td></tr>
</table>
<a href="{{ url_for('aggregator.edit_storage_service', id=storageService.id) }}"><button type="button" class="btn btn-info">Edit</button></a>
<a href="{{ url_for('aggregator.delete_storage_service', id= storageService.id) }}"<button type="button" class="btn btn-danger">Delete</button></a>
<a href="{{ url_for('aggregator.new_storage_service') }}"><button type="button" class="btn btn-success">New storage service</button></a>
<hr />

<div class="alert alert-info"><strong>METS fetch jobs</strong></div>

<table id="infotable" class="table table-striped table-bordered">
  <thead>
  <tr>
  <th><strong>Scan date</strong></th>
  <th><strong>Download duration</strong></th>
  <th><strong>Packages in SS</strong></th>
  <th><strong>AIP METS downloaded</strong></th>
  <th><strong>METS parsing duration</strong></th>
  <th><strong>Action</strong></th>
  </tr>
  </thead>
  {% if metsFetchJobs %}
    {% for metsFetchJob in metsFetchJobs %}
      <tr>
        <td>{{ metsFetchJob.download_start }}</td>
        <td>{{ metsFetchJob.download_end - metsFetchJob.download_start }}</td>
        <td>{{ metsFetchJob.total_packages }}</td>
        <td>{{ metsFetchJob.total_aips }}</td>
        <td>{{ metsFetchJob.parse_end - metsFetchJob.parse_start }}</td>
        <td>
          <a href="/view_aips/{{ metsFetchJob.id }}"><button type="button" class="btn btn-info">View AIPs</button></a>
          <a href="/delete_fetch_job/{{ metsFetchJob.id }}"><button type="button" class="btn btn-danger">Delete</button></a>
        </td>
      </tr>
    {% endfor %}
  {% endif %}
</table>
<button type="button" class="btn btn-success" style="margin-top: 20px;" id="newfetchjob">New fetch job</button>
<div id="console" style="margin-top: 20px; padding: 10px; border-radius: .25rem; color: #0F0; font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: small;">
</div>

<script>
$(document).ready(function(){
  $('#newfetchjob').on('click', function () {
    new_fetch_job({{ storageService.id }});
    });
})
</script>

{% endblock %}
